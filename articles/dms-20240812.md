---
title: ""
emoji: "😎"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: false
---
# Database Migration Service (DMS)とは
Database Migration Service (DMS)は、主に、オンプレミスで稼働しているMySQLやPostgreSQLデータベースをGoogle Cloud上に移行するために利用されるサービスです。
クラウド上のマネージドデータベースにリフトアンドシフトして、インフラ管理作業から解放されたり、マネージドサービス特有の高可用性、障害復旧、スケーリングの恩恵を受けることができます。

# サポートされているデータベース
Database Migration Serviceでサポートされているデータベースと移行パターンしては、以下通りになります。
| Database | Source Database | Destination Database |
| ---- | ---- | ---- |
| MySQL | Amazon RDS<br>On-Premise or Cloud VM<br>Cloud SQL<br>Amazon Aurora | Cloud SQL |
| PostgreSQL | Amazon RDS<br>On-Premise or Cloud VM<br>Cloud SQL<br>Amazon Aurora<br>Oracle | Cloud SQL |
| AlloyDB for PostgreSQL | Amazon RDS<br>On-Premise or Cloud VM<br>Cloud SQL<br>Amazon Aurora<br>Oracle | AlloyDB for PostgreSQL |
| SQL Server | Amazon RDS<br>On-Premise or Cloud VM | Cloud SQL for SQL Server |

サポートされている詳細なマイナーバージョンについては公式ドキュメントを確認してください。
https://cloud.google.com/database-migration/docs/supported-databases


# 移行方法
## 継続的な移行
Database Migration Serviceでは、継続的な移行がサポートされています。継続的な移行とは、初回のデータダンプとロードに加えて、ソースデータベースから
宛先データベースへ変更内容が継続的に連携されることを言います。継続的なデータ変更が連携されている場合は、宛先データベースはレプリカインスタンスとしてふるまいます。
完全に宛先データベースに移行するタイミングが来た場合、**プロモート**という操作を行うことで、宛先データベースがソースデータベースから完全に切り離され、
レプリカインスタンスからプライマリインスタンスに昇格されます。

## 一度限りの移行
Database Migration Serviceでは、一度限りの移行もサポートされています。
一度限りの移行とは、ソースデータベースの単一スナップショットをダンプし、宛先データベースにロードすることです。
移行中は、ソースデータベースに対して新規に書き込みを行うことができないため、移行期間中はダウンタイムが発生します。ロードが完了すると自動的に**プロモート**され、
宛先データベースがプライマリデータベースになります。


# ネットワーク接続性
Database Migration Serviceを利用するにあたり、ソースデータベースと宛先データベース間にネットワークの接続性を確立する必要があります。


| ネットワーク方式 | メリット | デメリット |
| ---- | ---- | ---- |
| ホワイトリストによるIP許可 | 設定が簡単<br>短期間の移行シナリオに推奨 | FWの設定が必要になる可能性<br>ソースデータベースにパブリックIPを付与する必要がある<br>接続がデフォルトで暗号化されていない |
| VMを介したリバースSSHトンネル | 設定が簡単<br>短期間の移行シナリオに推奨 | GoogleCloud間内での利用になる |
| VPCピアリング | 設定が簡単<br>高帯域幅 | AlloyDB for PostgreSQL |
| VPN | サードパーティーDBからの移行で利用される<br>中・高帯域幅 | VPN利用コストがかかる |
| Interconnect | 長期間かつ大容量の移行で利用<br>高帯域幅<br>オンプレミスとGoogleCloud間の移行で利用 | VPN利用コストがかかる |




# DMSでデータベースを移行するまでの流れ


# DMSの制限事項
すべてのPostgreSQLテーブルに主キーがあること
ソースPostgreSQLデータベースにpglogicalがインストールされていること