---
title: ""
emoji: "⛳"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: false
---

# Cloud KMSとは
Cloud KMS (Key Management Service)とは、Google Cloudが提供している鍵管理サービスです。
暗号鍵の作成や、使用、ローテーションなどを管理することができます。

# Cloud KMS基本概念
## キーリング
キーリングとは、特定のリージョン・マルチリージョン単位で鍵を管理するグループです。
キーリングの中に、鍵を作成し管理していきます。Google Cloudリソースである、Cloud StorageやBigQueryで鍵を利用したい場合は
ローケーション（リージョン・マルチリージョン）を一致させる必要があります。キーリングは一度作成すると削除することができないので、
キーリングを作成するローケーションは慎重に選ぶ必要があります。
費用については、鍵自体には費用が発生しますが、キーリング自体の費用は発生しません。

# 鍵のバージョン管理
また、鍵のバージョンには以下のステータスがあります。
- 生成を保留中（PENDING_GENERATION）
    - 非対称鍵のみに適用され、鍵が生成中の状態。使用準備が完了すると有効に遷移する。
- インポート保留中（PENDING_IMPORT）
    - インポートされた鍵にのみ適用され、鍵がインポート中の状態。使用準備が完了すると有効に遷移する。
- 有効（ENABLED）
    - 鍵バージョンは使用可能な状態
- 無効（DISABLED）
    - 鍵バージョンは使用できないが、鍵マテリアルは使用可能な状態でバージョンを有効化に戻すことも可能。
- 破棄の予定（DESTROY_SCHEDULED）
    - 鍵バージョンの破棄がスケジュールされており、スケジュールされた日数後破棄される。無効化に戻すことが可能
- 破棄（DESTROYED）
    - 鍵バージョンは破棄されており、鍵マテリアルもCloud KMS上に残っていない状態。破棄状態になった鍵バージョンはほかの状態にすることはできない。
- インポートに失敗しました（IMPORT_FAILED）
    - 鍵バージョンのインポートに失敗した状態。

:::alert
たとえ、鍵のステータスを「無効」、「破棄の予定」に変更しても「破棄」された鍵以外は、**費用**が発生するので注意が必要です。
:::

対称暗号化を利用している場合は、データの暗号化は**有効になっているメインの鍵バージョン**で行う必要があります。
メインの鍵バージョンが無効になっている場合は、その鍵を利用してデータを暗号化することはできず、
データの復号化に関しては、メインであるかどうかは影響せず、鍵バージョンが有効化であれば復号に利用することができます。
非対称暗号化、デジタル署名の場合は、鍵のステータスが有効かつ、鍵バージョンを指定して利用する必要があります。



# 鍵の目的とアルゴリズム
鍵を作成するときの項目として、**目的とアルゴリズム**があります。
目的は、


| 目的 | 説明 | 用途 |
| ---- | ---- | ---- |
| 対象暗号化/復号化 | 特定の時刻を測定するための指標 | CPU使用率 |
| raw対象暗号化/復号 | 時間間隔の変化を測定するための指標 | リクエスト数 |
| 非対称な署名 | 累積指標を測定するための指標 | ネットワーク送信・受信バイト数 |
| 非対称な復号化 | 累積指標を測定するための指標 | ネットワーク送信・受信バイト数 |
| MACの署名/検証 | 累積指標を測定するための指標 | ネットワーク送信・受信バイト数 |